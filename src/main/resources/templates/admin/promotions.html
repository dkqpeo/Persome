<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      th:replace="admin/layout :: layout('프로모션 관리', 'promotions', ~{::main}, ~{::scripts})">
<head>
    <title>프로모션 관리</title>
</head>
<body>
<main>
    <section id="panel-promotions" class="admin-section">
        <h2>프로모션 관리</h2>
        <div class="card">
            <div class="card-header">
                프로모션 목록
                <div style="display:flex; gap:8px; align-items:center;">
                    <button id="btn-promotion-refresh" class="secondary small">새로고침</button>
                    <button id="btn-promotion-create-open" class="primary small">+ 프로모션 생성</button>
                </div>
            </div>
            <div class="card-body">
                <div class="table-wrapper">
                    <table id="promotion-table">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>상태</th>
                            <th>할인 타입</th>
                            <th>할인 값</th>
                            <th>기간</th>
                            <th>이벤트</th>
                            <th>타겟 수</th>
                            <th>관리</th>
                        </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="promotion-form-create" class="card" style="display:none; margin-top:16px;">
            <div class="card-header">프로모션 등록</div>
            <form id="form-promotion-create" class="card-body form-grid">
                <label>상태
                    <select name="status" required>
                        <option value="DRAFT">DRAFT</option>
                        <option value="SCHEDULED">SCHEDULED</option>
                        <option value="ACTIVE">ACTIVE</option>
                        <option value="ENDED">ENDED</option>
                        <option value="INACTIVE">INACTIVE</option>
                    </select>
                </label>
                <label>할인 타입
                    <select name="discountType" required>
                        <option value="FIXED">FIXED</option>
                        <option value="RATE">RATE</option>
                    </select>
                </label>
                <label>할인 값<input type="number" name="discountValue" step="0.01" required></label>
                <label>시작일<input type="datetime-local" name="startDate" required></label>
                <label>종료일<input type="datetime-local" name="endDate" required></label>
                <label>이벤트 연결
                    <div style="display:flex; gap:8px; align-items:center;">
                        <input type="text" data-role="event-display-create" value="선택된 이벤트 없음" readonly style="flex:1;" />
                        <input type="hidden" name="eventId">
                        <button type="button" id="btn-clear-event-create" class="secondary small">제거</button>
                        <button type="button" id="btn-select-event-create" class="primary small">선택</button>
                    </div>
                </label>
                <label>타겟 유형
                    <select name="targetType">
                        <option value="ALL" selected>전체</option>
                        <option value="PRODUCT">상품</option>
                        <option value="CATEGORY">카테고리</option>
                        <option value="BRAND">브랜드</option>
                    </select>
                </label>
                <label>타겟 ID 목록 (콤마 구분)
                    <input type="text" name="targetIds" placeholder="1,2,3" disabled>
                </label>
                <div class="form-actions" style="display:flex; gap:8px;">
                    <button type="submit" class="primary">등록</button>
                    <button type="button" id="btn-cancel-promotion-create" class="secondary">취소</button>
                </div>
            </form>
        </div>

        <div id="promotion-form-manage" class="card" style="display:none; margin-top:16px;">
            <div class="card-header">프로모션 수정</div>
            <div class="card-body">
                <form id="form-promotion-update" class="form-grid">
                    <label>프로모션 ID<input type="number" name="promotionId" readonly required></label>
                    <label>상태<select name="status" required>
                        <option value="DRAFT">DRAFT</option>
                        <option value="SCHEDULED">SCHEDULED</option>
                        <option value="ACTIVE">ACTIVE</option>
                        <option value="ENDED">ENDED</option>
                        <option value="INACTIVE">INACTIVE</option>
                    </select></label>
                    <label>할인 타입<select name="discountType" required>
                        <option value="FIXED">FIXED</option>
                        <option value="RATE">RATE</option>
                    </select></label>
                    <label>할인 값<input type="number" name="discountValue" step="0.01" required></label>
                    <label>시작일<input type="datetime-local" name="startDate" required></label>
                    <label>종료일<input type="datetime-local" name="endDate" required></label>
                    <label>이벤트 연결
                        <div style="display:flex; gap:8px; align-items:center;">
                            <input type="text" data-role="event-display-update" value="선택된 이벤트 없음" readonly style="flex:1;" />
                            <input type="hidden" name="eventId">
                            <button type="button" id="btn-clear-event-update" class="secondary small">제거</button>
                            <button type="button" id="btn-select-event-update" class="primary small">선택</button>
                        </div>
                    </label>
                    <label>타겟 유형
                        <select name="targetType">
                            <option value="ALL">전체</option>
                            <option value="PRODUCT">상품</option>
                            <option value="CATEGORY">카테고리</option>
                            <option value="BRAND">브랜드</option>
                        </select>
                    </label>
                    <label>타겟 ID 목록 (콤마 구분)
                        <input type="text" name="targetIds" placeholder="1,2,3">
                    </label>
                    <div class="form-actions" style="display:flex; gap:8px;">
                        <button type="submit" class="primary">수정</button>
                        <button type="button" id="btn-cancel-promotion-update" class="secondary">취소</button>
                    </div>
                </form>

                <hr style="margin:24px 0;">

                <div class="card-subheader" style="font-weight:600; margin-bottom:8px;">프로모션 삭제</div>
                <form id="form-promotion-delete" class="form-grid" style="margin-bottom:16px;">
                    <label>프로모션 ID<input type="number" name="promotionId" readonly required></label>
                    <button type="submit" class="danger">삭제</button>
                </form>

                <div class="card-subheader" style="font-weight:600; margin-bottom:8px;">타겟 상품 재지정</div>
                <form id="form-promotion-products" class="form-grid">
                    <label>프로모션 ID<input type="number" name="promotionId" readonly required></label>
                    <label>상품 ID 목록 (콤마 구분)
                        <input type="text" name="productIds" placeholder="1,2,3" required>
                    </label>
                    <button type="submit" class="primary">저장</button>
                </form>
            </div>
        </div>
        <div id="promotion-feedback" class="feedback"></div>
        <div id="promotion-event-selector" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.45); z-index:1000; align-items:center; justify-content:center; padding:24px;">
            <div style="background:#fff; border-radius:8px; width:100%; max-width:760px; max-height:80vh; display:flex; flex-direction:column; padding:24px; box-shadow:0 10px 30px rgba(0,0,0,0.25);">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                    <h3 style="margin:0; font-size:20px;">이벤트 선택</h3>
                    <button type="button" id="btn-close-promotion-event-selector" class="secondary small">닫기</button>
                </div>
                <div class="table-wrapper" style="flex:1; overflow:auto;">
                    <table>
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>이름</th>
                            <th>상태</th>
                            <th>기간</th>
                            <th>선택</th>
                        </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>
</main>

<th:block th:fragment="scripts">
    <script type="module">
        import { initPromotionPanel } from '/js/admin/promotions.js';
        initPromotionPanel();
    </script>
</th:block>
</body>
</html>
