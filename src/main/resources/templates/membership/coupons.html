<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PERSOME ì¿ í°/í˜œíƒ</title>
    <link rel="stylesheet" href="/css/header.css">
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", Arial, sans-serif; 
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        .membership-header {
            text-align: left;
            margin-bottom: 60px;
            background: #f8f9fa;
            color: #333;
            padding: 80px 40px;
            position: relative;
            overflow: hidden;
            border-radius: 0;
        }
        
        .membership-header::before {
            content: '';
            position: absolute;
            top: 30px;
            right: 60px;
            width: 50px;
            height: 50px;
            background: #ff6b35;
            border-radius: 50%;
        }
        
        .membership-header::after {
            content: '';
            position: absolute;
            top: 100px;
            right: 140px;
            width: 70px;
            height: 35px;
            background: #4ecdc4;
            border-radius: 20px;
        }
        
        .header-decoration {
            position: absolute;
            top: 50px;
            right: 200px;
            width: 80px;
            height: 50px;
            background: #ffe66d;
            border-radius: 25px 25px 0 25px;
        }
        
        .membership-header h1 {
            font-size: 42px;
            font-weight: 700;
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .membership-header p {
            font-size: 18px;
            margin: 0 0 40px 0;
            color: #666;
            font-weight: 400;
        }
        
        .header-buttons {
            margin-top: 40px;
            display: flex;
            gap: 20px;
        }
        
        .header-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            text-align: center;
            transition: opacity 0.3s ease;
        }
        
        .header-btn.primary {
            background: #e9ecef;
            color: #333;
        }
        
        .header-btn.secondary {
            background: #666;
            color: white;
        }
        
        .header-btn:hover {
            opacity: 0.8;
        }
        
        /* ì¥ì‹ ìš”ì†Œë“¤ */
        .decorative-elements {
            position: relative;
            margin: 60px 0;
            height: 200px;
            overflow: hidden;
        }
        
        .deco-shape {
            position: absolute;
        }
        
        .deco-shape.star {
            top: 20px;
            left: 200px;
            width: 30px;
            height: 30px;
            background: #ffe66d;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
        }
        
        .deco-shape.wave {
            top: 150px;
            left: 50px;
            width: 80px;
            height: 20px;
            background: #4ecdc4;
            border-radius: 40px 40px 0 0;
        }
        
        .deco-shape.circle {
            top: 50px;
            right: 300px;
            width: 40px;
            height: 40px;
            background: #ff6b9d;
            border-radius: 50%;
        }
        
        .deco-shape.triangle {
            top: 120px;
            right: 150px;
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-bottom: 35px solid #37b042;
        }
        
        /* ì‚¬ìš©ì ë“±ê¸‰ ì„¹ì…˜ */
        .user-level-section {
            text-align: center;
            margin: 80px 0;
            position: relative;
        }
        
        .user-avatar {
            width: 120px;
            height: 120px;
            background: #e9ecef;
            border-radius: 50%;
            margin: 0 auto 30px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: #999;
            border: 4px solid #ddd;
        }
        
        .user-level-text {
            font-size: 28px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }
        
        .user-level-name {
            font-size: 32px;
            font-weight: 700;
            color: #674ea7;
            margin: 0;
        }
        
        .guest-notice {
            text-align: center;
            margin: 80px 0;
        }
        
        .notice-card {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .notice-card h3 {
            color: #333;
            margin: 0 0 20px 0;
            font-size: 18px;
        }
        
        .login-btn {
            background: #333;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 14px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        
        /* ì¿ í° ë“±ë¡ ì„¹ì…˜ */
        .coupon-register-section {
            background: #e7f3ff;
            border-radius: 12px;
            padding: 25px 30px;
            margin: 40px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .coupon-register-info {
            display: flex;
            align-items: center;
        }
        
        .coupon-register-icon {
            width: 40px;
            height: 40px;
            background: #4ecdc4;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            color: white;
            font-size: 18px;
        }
        
        .coupon-register-text {
            font-size: 16px;
            color: #333;
        }
        
        .coupon-register-btn {
            background: #4ecdc4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }
        
        .coupon-register-btn:hover {
            opacity: 0.8;
        }
        
        /* ì¿ í° ì„¹ì…˜ */
        .coupons-section {
            margin: 60px 0;
        }
        
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
        }
        
        .section-title {
            display: flex;
            align-items: center;
            font-size: 24px;
            font-weight: 600;
            color: #333;
        }
        
        .section-icon {
            width: 40px;
            height: 40px;
            background: #7cb342;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
            font-size: 18px;
        }
        
        .view-all-btn {
            color: #666;
            text-decoration: none;
            font-size: 14px;
            display: flex;
            align-items: center;
        }
        
        .view-all-btn::after {
            content: '>';
            margin-left: 5px;
        }
        
        /* ì¿ í° ì¹´ë“œ */
        .coupon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .coupon-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .coupon-main {
            background: linear-gradient(135deg, #7cb342 0%, #8bc34a 100%);
            color: white;
            padding: 25px 20px;
            position: relative;
        }
        
        .coupon-label {
            font-size: 12px;
            margin-bottom: 8px;
            opacity: 0.9;
        }
        
        .coupon-value {
            font-size: 36px;
            font-weight: 700;
            margin: 5px 0;
        }
        
        .coupon-condition {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .coupon-badge {
            position: absolute;
            top: 15px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .coupon-actions {
            padding: 20px;
            text-align: center;
        }
        
        .download-btn {
            background: #f5f5f5;
            border: 1px solid #ddd;
            color: #333;
            padding: 10px 24px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .download-btn:hover {
            background: #e9ecef;
        }
        
        @media (max-width: 768px) {
            .membership-header {
                padding: 40px 20px;
            }
            
            .membership-header h1 {
                font-size: 32px;
            }
            
            .coupon-register-section {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div id="header"></div>
    
    <div class="container">
        <!-- í—¤ë” ì„¹ì…˜ -->
        <div class="membership-header">
            <div class="header-decoration"></div>
            <h1>PERSOME ë©¤ë²„ì‹­ ë¼ìš´ì§€</h1>
            <p>ì‡¼í•‘í•˜ëŠ” ì¬ë¯¸! PERSOMEë§Œì˜ ë” íŠ¹ë³„í•œ í˜œíƒ</p>
            <div class="header-buttons">
                <a href="/membership" class="header-btn primary">PERSOME ë©¤ë²„ì‹­</a>
                <a href="/membership/coupons" class="header-btn secondary">ì¿ í°/í˜œíƒ</a>
            </div>
        </div>
        
        <!-- ì¥ì‹ ìš”ì†Œë“¤ -->
        <div class="decorative-elements">
            <div class="deco-shape star"></div>
            <div class="deco-shape wave"></div>
            <div class="deco-shape circle"></div>
            <div class="deco-shape triangle"></div>
        </div>
        
        <!-- ë¹„ë¡œê·¸ì¸ ìƒíƒœ ì•ˆë‚´ -->
        <div class="guest-notice" style="display: block;">
            <div class="notice-card">
                <h3>ë¡œê·¸ì¸ í›„ ê³ ê°ë‹˜ì˜ ë“±ê¸‰ê³¼ ì¿ í° í˜œíƒì„ í™•ì¸í•˜ì„¸ìš”</h3>
                <a href="/users/login" class="login-btn">ë¡œê·¸ì¸í•˜ê¸°</a>
            </div>
        </div>

        <!-- ì‚¬ìš©ì ë“±ê¸‰ í‘œì‹œ -->
        <div class="user-level-section logged-in-content" style="display: none;">
            <div class="user-avatar">ğŸ‘¤</div>
            <div class="user-level-text">ê³ ê°ë‹˜ì˜ ë“±ê¸‰ì€</div>
            <h2 class="user-level-name">BABY</h2>
            <p style="color: #666; margin-top: 10px;">ì…ë‹ˆë‹¤</p>
        </div>
        
        <!-- ì¿ í° ë“±ë¡ ì„¹ì…˜ -->
        <div class="coupon-register-section">
            <div class="coupon-register-info">
                <div class="coupon-register-icon">+</div>
                <div class="coupon-register-text">ì¿ í° ë“±ë¡ &nbsp;&nbsp; ë°›ì€ ë°›ìœ¼ì‹  ì¿ í°ì„ ë“±ë¡í•´ì£¼ì„¸ìš”</div>
            </div>
            <div>
                <button class="coupon-register-btn">ì¿ í°ë“±ë¡</button>
            </div>
        </div>
        
        <!-- PERSOME ë©¤ë²„ì‹­ ì¿ í° -->
        <div class="coupons-section">
            <div class="section-header">
                <div class="section-title">
                    <div class="section-icon">+</div>
                    <span>PERSOME ë©¤ë²„ì‹­ ì¿ í°</span>
                </div>
                <a href="#" class="view-all-btn">ì¿ í°í•¨ë‚´</a>
            </div>
            
            <div class="coupon-grid">
                <div class="coupon-card">
                    <div class="coupon-main">
                        <div class="coupon-badge">COUPON</div>
                        <div class="coupon-label">[9ì›” BABY] 3ë§Œì›ì´ìƒ 1ì²œì› í• ì¸</div>
                        <div class="coupon-value">1,000ì›</div>
                        <div class="coupon-condition">30,000ì› ì´ìƒ ì ìš©ê°€ëŠ¥</div>
                    </div>
                    <div class="coupon-actions">
                        <button class="download-btn">ì¿ í° ë‹¤ìš´ë°›ê¸° â¬‡</button>
                    </div>
                </div>
                
                <!-- ì¶”ê°€ ì¿ í°ë“¤ì€ ë¡œê·¸ì¸ ìƒíƒœì™€ ë“±ê¸‰ì— ë”°ë¼ ë™ì ìœ¼ë¡œ í‘œì‹œ -->
            </div>
        </div>
    </div>
    
    <script src="/js/header.js"></script>
    <script>
        // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ë° UI ì—…ë°ì´íŠ¸
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatusAndUpdateUI();
        });
        
        async function checkLoginStatusAndUpdateUI() {
            const guestNotice = document.querySelector('.guest-notice');
            const loggedInContent = document.querySelector('.logged-in-content');
            
            try {
                const res = await fetch("/api/users/me", { credentials: "include" });
                
                if (res.ok) {
                    // ë¡œê·¸ì¸ ìƒíƒœ: ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì™€ì„œ UI ì—…ë°ì´íŠ¸
                    const user = await res.json();
                    updateMemberInfo(user);
                    guestNotice.style.display = 'none';
                    loggedInContent.style.display = 'block';
                } else if (res.status === 401) {
                    // ë¹„ë¡œê·¸ì¸ ìƒíƒœ: ë¹„ë¡œê·¸ì¸ ë©”ì‹œì§€ í‘œì‹œ
                    guestNotice.style.display = 'block';
                    loggedInContent.style.display = 'none';
                }
            } catch (e) {
                console.error("ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨", e);
                // ì—ëŸ¬ ë°œìƒì‹œ ë¹„ë¡œê·¸ì¸ ìƒíƒœë¡œ ì²˜ë¦¬
                guestNotice.style.display = 'block';
                loggedInContent.style.display = 'none';
            }
        }
        
        function updateMemberInfo(user) {
            // ì‚¬ìš©ì ì´ë¦„ ì—…ë°ì´íŠ¸
            const userTextElement = document.querySelector('.user-level-text');
            if (userTextElement) {
                userTextElement.textContent = `${user.displayName || user.name || 'ê³ ê°'}ì˜ ë“±ê¸‰ì€`;
            }
            
            // ë©¤ë²„ì‹­ ë“±ê¸‰ ì •ë³´ ì—…ë°ì´íŠ¸
            const membershipLevel = user.membershipLevel || 'BABY';
            const levelInfo = getLevelInfo(membershipLevel);
            
            // ë“±ê¸‰ëª… í‘œì‹œ ì—…ë°ì´íŠ¸
            const levelNameElement = document.querySelector('.user-level-name');
            if (levelNameElement) {
                levelNameElement.textContent = levelInfo.displayName;
                levelNameElement.style.color = levelInfo.color;
            }
            
            // ì•„ë°”íƒ€ í…Œë‘ë¦¬ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
            const userAvatar = document.querySelector('.user-avatar');
            if (userAvatar) {
                userAvatar.style.borderColor = levelInfo.color;
            }
            
            // ë“±ê¸‰ë³„ ì¿ í° ì—…ë°ì´íŠ¸
            updateCouponsForLevel(membershipLevel);
        }
        
        function getLevelInfo(level) {
            const levelMap = {
                'BABY': {
                    displayName: 'BABY',
                    color: '#674ea7'
                },
                'PINK': {
                    displayName: 'PINK',
                    color: '#ff6b9d'
                },
                'GREEN': {
                    displayName: 'GREEN',
                    color: '#37b042'
                },
                'BLACK': {
                    displayName: 'BLACK',
                    color: '#333'
                },
                'GOLD': {
                    displayName: 'GOLD',
                    color: '#ffd700'
                }
            };
            
            return levelMap[level] || levelMap['BABY'];
        }
        
        function updateCouponsForLevel(level) {
            const couponGrid = document.querySelector('.coupon-grid');
            if (!couponGrid) return;
            
            const levelInfo = getLevelInfo(level);
            const couponsData = getCouponsForLevel(level);
            
            // ê¸°ì¡´ ì¿ í° ì¹´ë“œë¥¼ ëª¨ë‘ ì œê±°í•˜ê³  ìƒˆë¡œ ìƒì„±
            couponGrid.innerHTML = '';
            
            couponsData.forEach(coupon => {
                const couponCard = document.createElement('div');
                couponCard.className = 'coupon-card';
                couponCard.innerHTML = `
                    <div class="coupon-main" style="background: linear-gradient(135deg, ${levelInfo.color} 0%, ${levelInfo.color}CC 100%);">
                        <div class="coupon-badge">COUPON</div>
                        <div class="coupon-label">${coupon.label}</div>
                        <div class="coupon-value">${coupon.value}</div>
                        <div class="coupon-condition">${coupon.condition}</div>
                    </div>
                    <div class="coupon-actions">
                        <button class="download-btn">ì¿ í° ë‹¤ìš´ë°›ê¸° â¬‡</button>
                    </div>
                `;
                couponGrid.appendChild(couponCard);
            });
        }
        
        function getCouponsForLevel(level) {
            const couponsMap = {
                'BABY': [
                    {
                        label: '[10ì›” BABY] 3ë§Œì›ì´ìƒ 3ì²œì› í• ì¸',
                        value: '3,000ì›',
                        condition: '30,000ì› ì´ìƒ ì ìš©ê°€ëŠ¥'
                    },
                    {
                        label: '[BABY] ë¬´ë£Œë°°ì†¡ ì¿ í°',
                        value: 'ë¬´ë£Œë°°ì†¡',
                        condition: 'ì „ì²´ ìƒí’ˆ ì ìš©ê°€ëŠ¥'
                    }
                ],
                'PINK': [
                    {
                        label: '[10ì›” PINK] 5ë§Œì›ì´ìƒ 5ì²œì› í• ì¸',
                        value: '5,000ì›',
                        condition: '50,000ì› ì´ìƒ ì ìš©ê°€ëŠ¥'
                    },
                    {
                        label: '[PINK] ë¬´ë£Œë°°ì†¡ ì¿ í°',
                        value: 'ë¬´ë£Œë°°ì†¡',
                        condition: 'ì „ì²´ ìƒí’ˆ ì ìš©ê°€ëŠ¥'
                    },
                    {
                        label: '[PINK] ìš°ì„ ë°°ì†¡ ì¿ í°',
                        value: 'ìš°ì„ ë°°ì†¡',
                        condition: 'ì „ì²´ ìƒí’ˆ ì ìš©ê°€ëŠ¥'
                    }
                ],
                'GREEN': [
                    {
                        label: '[10ì›” GREEN] 7ë§Œì›ì´ìƒ 1ë§Œì› í• ì¸',
                        value: '10,000ì›',
                        condition: '70,000ì› ì´ìƒ ì ìš©ê°€ëŠ¥'
                    },
                    {
                        label: '[GREEN] ë¬´ë£Œë°°ì†¡ ì¿ í°',
                        value: 'ë¬´ë£Œë°°ì†¡',
                        condition: 'ì „ì²´ ìƒí’ˆ ì ìš©ê°€ëŠ¥'
                    },
                    {
                        label: '[GREEN] ìƒ˜í”Œì¦ì • ì¿ í°',
                        value: 'ìƒ˜í”Œì¦ì •',
                        condition: 'êµ¬ë§¤ì‹œ ìë™ ì ìš©'
                    }
                ],
                'BLACK': [
                    {
                        label: '[10ì›” BLACK] 10ë§Œì›ì´ìƒ 2ë§Œì› í• ì¸',
                        value: '20,000ì›',
                        condition: '100,000ì› ì´ìƒ ì ìš©ê°€ëŠ¥'
                    },
                    {
                        label: '[BLACK] ë¬´ë£Œë°°ì†¡ ì¿ í°',
                        value: 'ë¬´ë£Œë°°ì†¡',
                        condition: 'ì „ì²´ ìƒí’ˆ ì ìš©ê°€ëŠ¥'
                    },
                    {
                        label: '[BLACK] VIP ì „ìš©í• ì¸',
                        value: '15%í• ì¸',
                        condition: 'ì „ìš©ìƒí’ˆ ì ìš©ê°€ëŠ¥'
                    }
                ],
                'GOLD': [
                    {
                        label: '[10ì›” GOLD] 15ë§Œì›ì´ìƒ 3ë§Œì› í• ì¸',
                        value: '30,000ì›',
                        condition: '150,000ì› ì´ìƒ ì ìš©ê°€ëŠ¥'
                    },
                    {
                        label: '[GOLD] í”„ë¦¬ë¯¸ì—„ ë°°ì†¡',
                        value: 'í”„ë¦¬ë¯¸ì—„ë°°ì†¡',
                        condition: 'ë‹¹ì¼/ìµì¼ ë°°ì†¡'
                    },
                    {
                        label: '[GOLD] VIP ì „ìš©í• ì¸',
                        value: '20%í• ì¸',
                        condition: 'ì „ì²´ìƒí’ˆ ì ìš©ê°€ëŠ¥'
                    },
                    {
                        label: '[GOLD] ì „ë‹´ì»¨ì„¤í„´íŠ¸',
                        value: '1:1ìƒë‹´',
                        condition: 'ê°œì¸ë§ì¶¤ ì„œë¹„ìŠ¤'
                    }
                ]
            };
            
            return couponsMap[level] || couponsMap['BABY'];
        }
    </script>
</body>
</html>