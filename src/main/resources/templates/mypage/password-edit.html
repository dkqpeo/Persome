<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>비밀번호 변경 | Persome</title>
    <link rel="stylesheet" href="/css/header.css" />
    <style>
        body{font-family:"Noto Sans KR",Arial,sans-serif;margin:0;color:#333}
        .container{max-width:1100px;margin:20px auto;padding:0 16px}
        .grid{display:grid;grid-template-columns:260px 1fr;gap:24px;margin-top:18px;align-items:start}
        .card{border:1px solid #eee;border-radius:16px;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,0.06);overflow:hidden}
        .card .hd{padding:16px 20px;border-bottom:1px solid #f0f0f0;font-weight:700;font-size:18px;color:#222;background:linear-gradient(90deg,#F6F3FF,#fff)}
        .card .bd{padding:20px}
        .form-list{list-style:none;margin:0;padding:0;display:grid;gap:16px}
        .form-list li{display:flex;flex-direction:column}
        .form-list label{font-size:13px;color:#666;font-weight:600;margin-bottom:6px}
        .form-list input{padding:10px 12px;border:1px solid #ddd;border-radius:6px;font-size:14px;box-sizing:border-box}
        .form-list input:focus{border-color:#A68DC0;outline:none;box-shadow:0 0 0 2px rgba(166,141,192,0.2)}
        #pwActions{display:flex;justify-content:flex-end;gap:10px;margin-top:20px}
        .btn{background:#A68DC0;color:#fff;padding:8px 16px;border-radius:6px;border:none;cursor:pointer;font-size:14px;font-weight:600;transition:background .2s}
        .btn:hover{background:#8c75a6}
        .btn-cancel{background:#ccc;color:#333}
        .btn-cancel:hover{background:#999}
        @media(max-width:768px){.grid{grid-template-columns:1fr}}
    </style>
</head>
<body>
<div id="header"></div>
<div id="siteHeader"></div>
<div class="container">
    <div id="hero"></div>
    <div id="kpi"></div>
    <div class="grid">
        <div id="sidebar"></div>
        <div class="card">
            <div class="hd">비밀번호 변경</div>
            <div class="bd">
                <ul class="form-list">
                    <li>
                        <label for="oldPw">현재 비밀번호</label>
                        <input type="password" id="oldPw" placeholder="현재 비밀번호 입력" />
                    </li>
                    <li>
                        <label for="newPw">새 비밀번호</label>
                        <input type="password" id="newPw" placeholder="새 비밀번호 (8자 이상)" />
                    </li>
                    <li>
                        <label for="newPwConfirm">새 비밀번호 확인</label>
                        <input type="password" id="newPwConfirm" placeholder="새 비밀번호 확인" />
                    </li>
                </ul>
                <div id="pwActions">
                    <button id="btnPwSave" class="btn">변경하기</button>
                    <button id="btnPwCancel" class="btn btn-cancel">취소</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/js/header.js"></script>
<script src="/js/fragment-loader.js"></script>
<script src="/js/mypage.js"></script>
<script>
    // 비밀번호 변경 로직
    async function updatePassword() {
        const oldPassword = document.getElementById("oldPw").value;
        const newPassword = document.getElementById("newPw").value;
        const confirmPw = document.getElementById("newPwConfirm").value;

        if (!oldPassword || !newPassword || !confirmPw) {
            return alert("모든 항목을 입력해주세요.");
        }
        if (newPassword !== confirmPw) {
            return alert("새 비밀번호가 일치하지 않습니다.");
        }

        try {
            const res = await fetch("/api/users/me/password", {
                method: "PATCH",
                headers: { "Content-Type": "application/json" },
                credentials: "include",
                body: JSON.stringify({ oldPassword, newPassword }),
            });
            const data = await res.json();
            if (!res.ok) throw new Error(data.message || "비밀번호 변경 실패");
            alert("비밀번호가 성공적으로 변경되었습니다.");
            document.getElementById("oldPw").value = "";
            document.getElementById("newPw").value = "";
            document.getElementById("newPwConfirm").value = "";
            location.href = "/mypage/info";
        } catch (e) {
            alert(e.message);
        }
    }

    document.addEventListener("DOMContentLoaded", () => {
        document.getElementById("btnPwSave").addEventListener("click", updatePassword);
        document.getElementById("btnPwCancel").addEventListener("click", () => {
            location.href = "/mypage/info";
        });
    });
</script>
</body>
</html>